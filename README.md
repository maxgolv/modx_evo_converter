# modx_evo_converter
Конвертер валют для магазина на modx evo (shopkeeper)

КОНВЕРТЕР ВАЛЮТ


curr.php - в корень сайта ( затем в крон )

необходим лишь для того, что бы получать значения курсов валют и записи их в тв.
тв-параметры для курса валют (тип - text, относятся к главному шаблону). Для того, что бы тв появились в базе они должны быть заполнены, т.е. необходим ввести значение по-умолчанию. 

//////

price_change - сниппет для пересчета товара, в зависимости от валют.

для работы необходимо

1) тв-параметр price - цена ( в независимости от того какая валюта вводится )

2) тв-параметр val - выпадающее меню, указывающее какая валюта выбрана.

тип - DropDown List Menu, 

возможные значения:

USD==usd||EUR==eur||RUR==rur

Значение по умолчанию: 

usd

3) тв-параметр marge (тип - text) - необязательный параметр ( если не нужен, необходимо подправить сниппет ).
указывает наценку на товар

рассчет цены в рублях введется по формуле

цена * ( курс выбранной валюты * наценка ) == 1000 * ( 73.12 * 1.10 )

вызов сниппета 

на странице товара
[!price_change? &marge=`[*marge*]` &price=`[*price*]` &vlt=`[*val*]`!]


в каталоге, для товара

[[price_change? &marge=`[+marge+]` &price=`[+price+]` &vlt=`[+val+]`]]

По аналогу можно также пересчитывать старую цену и т.п.

Вместе с вызовом, в форме заказа товара ( там где кнопка "В корзину" )
вставить скрытое поле для плагина (напомню, что вызов меняется в зависимости от места вызова )


<input type="hidden" name="shk-price" value="[!price_change? &marge=`[*marge*]` &price=`[*price*]` &vlt=`[*val*]`!]">



////////

плагин price_in

ставить на событие - OnSHKgetProductPrice

необходим для того что бы shopkeeper ловил значение пересчитанной цены и передавал в корзину

